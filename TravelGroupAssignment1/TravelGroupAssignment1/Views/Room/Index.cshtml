@model List<Room>
@{
    ViewData["Title"] = "List of Rooms";
    string hotelName = ViewBag.HotelName;
    int hotelId = ViewBag.HotelId as int? ?? 0;
    string? searchLocation = ViewBag.Location as string;
    int searchCapacity = ViewBag.Capacity as int? ?? 0;
    bool searchValid = ViewBag.SearchValid as bool? ?? false;
    DateTime searchCheckInDate = ViewBag.CheckInDate != null ? ViewBag.CheckInDate : DateTime.Now;
    DateTime searchCheckOutDate = ViewBag.CheckOutDate != null ? ViewBag.CheckOutDate : DateTime.Now.AddDays(2);
}
<br />
<br />
<h2>@hotelName</h2>
<div class="tab-pane" role="tabpanel" aria-labelledby="room-tab" tabindex="0">
    <div id="roomForm" class="search-form">
        <h4>Room Search</h4>
        <form asp-action="Search" class="form" method="get">
            <div asp-validation-summary="ModelOnly" class="text-warning"></div>
            <input hidden required id="hotelId" name="hotelId" value="@hotelId" class="form-control" />

            <div class="form-group mb-2 d-inline-block">
                <label for="capacity" class="control-label">Travellers</label>
                <input required id="capacity" name="capacity" type="number" value="@(searchCapacity == 0 ? 2 : searchCapacity)" class="form-control" />
            </div>

            <div class="form-group mb-2 d-inline-block">
                <label for="checkInDate" class="control-label">Start Date</label>
                <input required id="checkInDate" name="checkInDate" type="date" value="@searchCheckInDate.ToString("yyyy-MM-dd")" min="@DateTime.Now.ToString("yyyy-MM-dd")" class="form-control" onchange="updateCheckOutDateLimit('checkInDate', 'checkOutDate')" />
            </div>

            <div class="form-group mb-2 d-inline-block">
                <label for="checkOutDate" class="control-label">End Date</label>
                <input required id="checkOutDate" name="checkOutDate" type="date" value="@searchCheckOutDate.ToString("yyyy-MM-dd")" min="@DateTime.Now.ToString("yyyy-MM-dd")" class="form-control" />
            </div>

            <input type="submit" value="Search" class="btn btn-primary" />
            @if (searchValid)
            {
                <a asp-action="Index" asp-route-hotelId="@hotelId" class="btn btn-secondary">Clear Search</a>
            }
        </form>
    </div>
</div>
<br />
<h4>@ViewData["Title"]</h4>
<br />

@if (Model.Any())
{
    <!-- Room Card -->
    <div class="row">
        @foreach (var room in Model)
        {
            <div class="col-12 col-sm-4">
                <div class="card shadow" style="width: 18rem;">
                    <a asp-action="Details" asp-route-id="@room.RoomId" class="card-link">
                        <img id="@room.RoomId" src="https://assets-global.website-files.com/5c6d6c45eaa55f57c6367749/65045f093c166fdddb4a94a5_x-65045f0266217.webp" class="card-img-top" alt="Hotel Room" style="width: 100%; height: 100%;">
                        <div class="card-body">
                            <h4 class="card-title">@room.Name</h4>
                        </div>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">
                                <i class="fa-solid fa-user-group"></i> @room.Capacity
                            </li>
                            <li class="list-group-item">
                                <i class="fa-solid fa-bed"></i> @room.BedDescription
                            </li>
                            <li class="list-group-item">
                                <i class="fa-solid fa-expand"></i> @room.RoomSize sq ft
                            </li>
                            <li class="list-group-item">
                                <i class="fa-solid fa-tag"></i> $450
                            </li>
                        </ul>
                        <a asp-controller="RoomBooking" asp-action="Create" asp-route-roomId="@room.RoomId" 
                            asp-route-checkInDate="@searchCheckInDate.ToString("yyyy-MM-dd")" asp-route-checkOutDate="@searchCheckOutDate.ToString("yyyy-MM-dd")" 
                            class="btn btn.sm btn-primary" role="button">Reserve Room</a>
                    </a>
                </div>
            </div>
            @*<script>
                (async () => {
                    const topic = 'hotel room';
                    const accessKey = 'WOgcw4SyGE-wP7k667o8j0Z3wgySWFLIaSr89ZOUkM4';

                    // Make API request to fetch random image by topic for this hotel
                    const response = await fetch(`https://api.unsplash.com/photos/random?query=${topic}&client_id=${accessKey}`);
                    const data = await response.json();
                    const imageUrl = data.urls.regular;

                    // Set the image src attribute dynamically for this hotel
    document.getElementById('@room.RoomId').src = imageUrl;
                })();
            </script> *@
        }
    </div>

}
else
{
    <p>No rooms available for booking</p>
}


